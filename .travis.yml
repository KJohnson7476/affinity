services:
- docker
before_install:
- sudo apt-get update
- sudo apt-get install -y python3.4
- sudo apt-get install -y jq
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- "./credentials.sh"
- aws ssm get-parameters-by-path --region us-west-2 --with-decryption --path "/api/affinity/demo/"
  | jq -r '.Parameters[] | ([.Name, "\"" + .Value + "\""]) | join("=")' > /tmp/demo.affinity.ini
- sed -i~ 's#/api/affinity/demo/##' /tmp/demo.affinity.ini
- mv /tmp/demo.affinity.ini .env
- docker build -t affinity .
- docker run --name affinity -d -v ${TRAVIS_BUILD_DIR}:/var/www affinity
script:
- docker exec affinity bash -c 'pwd && ls -la && composer install && vendor/bin/phpunit'
- rm .env
env:
  global:
    secure: g2JjRN5DUkTp/fMi3zlBiBSmtbePrrSrsbDdiHkPHfPQLF4E2t7bDsZdcekwd5k7MpPP2kGCMs4XCtY8OMFxU6NXCqmhffeX68G5Uq61YwXORnq2FO08DxBq7XjCRYKn9lni/EjEmxQlXuPsfrtNxwNQd23niPLeWhyx3DtYHi59Vp80LVhugT3hd5ntporrux23f9cdKuITInh5nHIM1RiIkCqZr7+vkn4O35X/XvGT1AnTg0LLWwb2+2MKXL+KJBLSfXfiFFag3ENbXTAWnx++sMRtVJZp29xYu9kMH3tVR90KZGle8Srsu4CzeQtvck/LrLpdwK393LwqDXOj4XYT9OdxX579KG9JdeTVMTP7ARkqBgz/FrjQH5T3G23/9Vt0jVHj2hQO89B3HEGFePzQtfteTaJCSvPJ5tTPQmxmziXRU2zAHvQIwLrFwj5+fvn7JCDUU5ixdSDFxEqH/navyM9F34xj4QnL5NltW1ZCGxGDlOrQ2MeZrFigi5/aHY97DmusmcLCXa3JQn91VJGIPREExzhYGPjnr+ObDNOebgGuUcFGHRIoCu7UochVY7UR0VSuAaZfF0YyyREOgYSjEO4GMLk7UhbxsXXXM01uljvc4x6oj7ch97tMR7DifsLJFDPeltlIVX1iAiPHbmIAHJbeRNpcEBApTG8vmbo=
